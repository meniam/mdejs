/*! mdejs 04-02-2016 */

!function(a){a.fn.mdejs=function(b){function c(a,b){this.input=a[0],this.preview=document.getElementsByClassName(b.preview_class)[0],this.buttonBar=document.createElement("div"),this.buttonBar.className="mde-toolbar",this.input.parentNode.insertBefore(this.buttonBar,this.input)}function d(a,b){b=b||{},b.lang=b.lang||{},b.helpButton=b.helpButton||{};var d,e=function(a){return b.lang[a]||u.lang[a]},g=this;this.run=function(k){if(!d){d=new c(k,b);var m,n=new h(a,d,function(){});/\?noundo/.test(document.location.href)||(l=new f(function(){n.refresh(),m&&m.setUndoRedoButtonStates()},d));var o=new j(e,a);m=new i(b,d,n,o,b.helpButton,e),m.setUndoRedoButtonStates();var p=g.refreshPreview=function(){n.refresh(!0)};p()}}}function e(){}function f(b,c){var d,e,f,h=this,i=[],j=0,k="none",l=function(a,b){k!=a&&(k=a,b||o()),r.isIE&&"moving"==k?f=null:e=setTimeout(m,1)},m=function(a){f=new g(c,a),e=void 0};this.setCommandMode=function(){k="command",o(),e=setTimeout(m,0)},this.canUndo=function(){return j>1},this.canRedo=function(){return!!i[j+1]},this.undo=function(){h.canUndo()&&(d?(d.restore(),d=null):(i[j]=new g(c),i[--j].restore(),b&&b())),k="none",c.input.focus(),m()},this.redo=function(){h.canRedo()&&(i[++j].restore(),b&&b()),k="none",c.input.focus(),m()};var o=function(){var a=f||new g(c);return a?"moving"==k?void(d||(d=a)):(d&&(i[j-1].text!=d.text&&(i[j++]=d),d=null),i[j++]=a,i[j+1]=null,void(b&&b())):!1},p=function(a){var b=!1;if((a.ctrlKey||a.metaKey)&&!a.altKey){var c=a.charCode||a.keyCode,d=String.fromCharCode(c);switch(d.toLowerCase()){case"y":h.redo(),b=!0;break;case"z":a.shiftKey?h.redo():h.undo(),b=!0}}return b?(a.preventDefault&&a.preventDefault(),window.event&&(window.event.returnValue=!1),null):void 0},q=function(a){if(!a.ctrlKey&&!a.metaKey){var b=a.keyCode;b>=33&&40>=b||b>=63232&&63235>=b?l("moving"):8==b||46==b||127==b?l("deleting"):13==b?l("newlines"):27==b?l("escape"):(16>b||b>20)&&91!=b&&l("typing")}},s=function(){a(c.input).on("keypress",function(a){!a.ctrlKey&&!a.metaKey||a.altKey||89!=a.keyCode&&90!=a.keyCode||a.preventDefault()});var b=function(){(r.isIE||f&&f.text!=c.input.value)&&void 0==e&&(k="paste",o(),m())};n.addEvent(c.input,"keydown",p),n.addEvent(c.input,"keydown",q),n.addEvent(c.input,"mousedown",function(){l("moving")}),c.input.onpaste=b,c.input.ondrop=b},t=function(){s(),m(!0),o()};t()}function g(a,b){var c=this,d=a.input;this.init=function(){n.isVisible(d)&&(b||!document.activeElement||document.activeElement===d)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=d.scrollTop,(!this.text&&d.selectionStart||0===d.selectionStart)&&(this.text=d.value))},this.setInputAreaSelection=function(){if(n.isVisible(d))if(void 0===d.selectionStart||r.isOpera){if(document.selection){if(document.activeElement&&document.activeElement!==d)return;d.focus();var a=d.createTextRange();a.moveStart("character",-d.value.length),a.moveEnd("character",-d.value.length),a.moveEnd("character",c.end),a.moveStart("character",c.start),a.select()}}else d.focus(),d.selectionStart=c.start,d.selectionEnd=c.end,d.scrollTop=c.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(a.ieCachedRange||!d.selectionStart&&0!==d.selectionStart){if(document.selection){c.text=n.fixEolChars(d.value);var b=a.ieCachedRange||document.selection.createRange(),e=n.fixEolChars(b.text),f="",g=f+e+f;b.text=g;var h=n.fixEolChars(d.value);b.moveStart("character",-g.length),b.text=e,c.start=h.indexOf(f),c.end=h.lastIndexOf(f)-f.length;var i=c.text.length-n.fixEolChars(d.value).length;if(i){for(b.moveStart("character",-e.length);i--;)e+="\n",c.end+=1;b.text=e}a.ieCachedRange&&(c.scrollTop=a.ieCachedScrollTop),a.ieCachedRange=null,this.setInputAreaSelection()}}else c.start=d.selectionStart,c.end=d.selectionEnd},this.restore=function(){void 0!=c.text&&c.text!=d.value&&(d.value=c.text),this.setInputAreaSelection(),d.scrollTop=c.scrollTop},this.getChunks=function(){var a=new e;return a.before=n.fixEolChars(c.text.substring(0,c.start)),a.startTag="",a.selection=n.fixEolChars(c.text.substring(c.start,c.end)),a.endTag="",a.after=n.fixEolChars(c.text.substring(c.end)),a.scrollTop=c.scrollTop,a},this.setChunks=function(a){a.before=a.before+a.startTag,a.after=a.endTag+a.after,this.start=a.before.length,this.end=a.before.length+a.selection.length,this.text=a.before+a.selection+a.after,this.scrollTop=a.scrollTop},this.init()}function h(b,c,d){var e,f,g,h=3e3,i="delayed",j=function(a,b){n.addEvent(a,"input",b),a.onpaste=b,a.ondrop=b,n.addEvent(a,"keypress",b),n.addEvent(a,"keydown",b)},k=function(){if(c.preview){var a=c.input.value;if(!a||a!=g){g=a;var b=(new Date).getTime();a=v.converter.makeHtml(a);var d=(new Date).getTime();f=d-b,w(a)}}},l=function(){if(e&&(clearTimeout(e),e=void 0),"manual"!==i){var a=0;"delayed"===i&&(a=f),a>h&&(a=h),e=setTimeout(k,a)}},m=function(){c.preview};this.refresh=function(a){a?(g="",k()):l()},this.processingTime=function(){return f};var p,q=!0,s=function(a){var b=c.preview,d=b.parentNode,e=b.nextSibling;d.removeChild(b),b.innerHTML=a,e?d.insertBefore(b,e):d.appendChild(b)},t=function(a){c.preview.innerHTML=a},u=function(a){if(p)return p(a);try{t(a),p=t}catch(b){p=s,p(a)}},w=function(b){var e=a(document).scrollTop(),f=o.getTop(c.input)-e;if(c.preview&&(u(b),d()),m(),q)return void(q=!1);var g=o.getTop(c.input)-e;r.isIE?setTimeout(function(){window.scrollBy(0,g-f)},0):window.scrollBy(0,g-f)},x=function(){j(c.input,l),k(),c.preview&&(c.preview.scrollTop=0)};x()}function i(b,c,d,e,f,h){function i(a){if(p.focus(),a.textOp){l&&l.setCommandMode();var b=new g(c);if(!b)return;var e=b.getChunks(),f=function(){p.focus(),e&&b.setChunks(e),b.restore(),d.refresh()},h=a.textOp(e,f);h||f()}a.execute&&a.execute(l)}function j(a,b){b?(a.disabled=!1,a.onclick=function(){return this.onmouseout&&this.onmouseout(),i(this),!1}):a.disabled=!0}function k(a){return"string"==typeof a&&(a=e[a]),function(){a.apply(e,arguments)}}function m(){var b=function(){var b=a("<div/>",{"class":"btn-toolbar"})[0];return c.buttonBar.appendChild(b)},d=function(a,b){var c=document.createElement("div");return c.className="btn-group",b.appendChild(c),c},e=function(b,c){var d=a("<button/>",{"class":"btn btn-default"})[0],e=document.createElement("i");return e.className=b.icon,d.appendChild(e),d.title=h(b.name),b.hotkey&&(d.title=d.title+" — "+(r.isWin?"Ctrl+"+b.hotkey.toUpperCase():"⌘"+b.hotkey.toUpperCase())),b.action&&(d.textOp=k(b.action)),b.execute&&(d.execute=b.execute),j(d,!0),c.appendChild(d),d};a.each(v.toolbars,function(c,f){var g=b();a.each(f.panels,function(b,c){var f=d(c,g);a.each(c.buttons,function(a,b){q[b.name]=b,s[b.name]=e(b,f)})})}),o()}function o(){l&&(j(s.undo,l.canUndo()),j(s.redo,l.canRedo()))}var p=c.input,q={},s={};m();var t="keydown";r.isOpera&&(t="keypress"),a(p).on(t,function(b){if((b.ctrlKey||b.metaKey)&&!b.altKey&&!b.shiftKey){var c=b.charCode||b.keyCode,d=String.fromCharCode(c).toLowerCase();return a.each(q,function(a,c){c.hotkey&&c.hotkey.toLowerCase()==d&&(i(s[a]),b.preventDefault())}),null}}),n.addEvent(p,"keyup",function(a){if(!a.shiftKey&&!a.ctrlKey&&!a.metaKey){var b=a.charCode||a.keyCode;if(13===b){var c={};c.textOp=k("doAutoindent"),i(c)}}}),r.isIE&&n.addEvent(p,"keydown",function(a){return 27===a.keyCode?!1:void 0}),this.setUndoRedoButtonStates=o}function j(a,b){this.getString=a,this.converter=b}function k(a){return a.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(a,b,c){var d=!1;return b=b.replace(/%(?:[\da-fA-F]{2})|\?|\+|[^-\w\d.\/[\]]/g,function(a){if(3===a.length&&"%"==a.charAt(0))return a.toUpperCase();switch(a){case"?":return d=!0,"?";case"+":if(d)return"%20"}return encodeURI(a)}),c&&(c=c.trim?c.trim():c.replace(/^\s*/,"").replace(/\s*$/,""),c=c.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),c?b+' "'+c+'"':b})}var l,m=window.RegExp,n={},o={},p={},q={lineLength:72},r={isIE:/msie/.test(window.navigator.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(window.navigator.userAgent.toLowerCase())||/msie 5/.test(window.navigator.userAgent.toLowerCase()),isOpera:/opera/.test(window.navigator.userAgent.toLowerCase()),isWin:/win/.test(window.navigator.platform.toLowerCase())},s="http://",t="http://",u={textColor:"#000",toolbars:[{panels:[{buttons:[{name:"bold",hotkey:"b",icon:"fa fa-bold",css_class:"",action:"doBold"},{name:"italic",hotkey:"i",icon:"fa fa-italic",css_class:"",action:"doItalic"}]},{buttons:[{name:"heading",hotkey:"h",icon:"fa fa-header",css_class:"",action:"doHeading"},{name:"hr",hotkey:"",icon:"fa fa-ellipsis-h",css_class:"",action:"doHorizontalRule"}]},{buttons:[{name:"ulist",hotkey:"u",icon:"fa fa-list-ul",css_class:"",action:"doUlList"},{name:"olist",hotkey:"o",icon:"fa fa-list-ol",css_class:"",action:"doOlList"},{name:"quote",hotkey:"q",icon:"fa fa-quote-right",css_class:"",action:"doBlockquote"}]},{buttons:[{name:"code",hotkey:"k",icon:"fa fa-code",css_class:"",action:"doCode"},{name:"link",hotkey:"l",icon:"fa fa-link",css_class:"",action:"doLink"},{name:"image",hotkey:"g",icon:"fa fa-file-image-o",css_class:"",action:"doImage"}]},{buttons:[{name:"undo",hotkey:"z",icon:"fa fa-undo",css_class:"",action:null,execute:function(a){return a.undo()}},{name:"redo",icon:"fa fa-repeat",css_class:"",action:null,execute:function(a){return a.redo()}}]}]}],lang:{bold:"Жирный",boldexample:"Текст, выделенный жирным",italic:"Курсив",italicexample:"Текст, выделенный жирным",link:"Ссылка",linkdescription:"Описание ссылки",linkdialog:'<p><b>Вставить ссылку</b></p><p>http://yandex.ru/ "Опциональная подсказка"</p>',quote:"Цитата",quoteexample:"Текст цитаты",code:"Пример кода",codeexample:"Введите текст исходного кода",image:"Изображение",imagedescription:"Введите описание изображения",imagedialog:"<p><b>Вставка изображения</b></p><p>http://example.com/images/diagram.jpg \"Опцианальная подсказка\"<br><br>Нужен <a href='http://www.google.com/search?q=бесплатный+хостинг+картинок' target='_blank'>бесплатный хостинг картинок?</a></p>",olist:"Нумерованный список",ulist:"Маркированный список",litem:"Элемент списка",heading:"Заголовок h1/h2",headingexample:"Заголовок",hr:"Горизонтальная черта",undo:"Отменить — "+(r.isWin?"Ctrl+Z":"⌘Z"),redo:"Повторить — "+(r.isWin?"Ctrl+Y":"⇧⌘Z"),help:"Помощь"}},v=a.extend({},u,b);n.isVisible=function(b){return a(b).is(":visible")},n.addEvent=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},n.removeEvent=function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)},n.fixEolChars=function(a){return a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n")},n.extendRegExp=function(a,b,c){(null===b||void 0===b)&&(b=""),(null===c||void 0===c)&&(c="");var d=a.toString(),e=null;return d=d.replace(/\/([gim]*)$/,function(a,b){return e=b,""}),d=d.replace(/(^\/|\/$)/g,""),d=b+d+c,new m(d,e)},o.getTop=function(a,b){var c=a.offsetTop;if(!b)for(;a=a.offsetParent;)c+=a.offsetTop;return c},o.getHeight=function(a){return a.offsetHeight||a.scrollHeight},o.getWidth=function(a){return a.offsetWidth||a.scrollWidth},p.prompt=function(b,c,d){a('<div id="mdejs-prompt-dialog" class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog modal-md"><div class="modal-content"><form class="mde-dialog-form"><div class="modal-body">'+b+'<div class="input-group input-group-sm" style="width:100%"><input class="form-control mde-dialog-input" type="text" value="'+c+'"></div></div><div class="modal-footer"><button type="button" class="btn btn-primary mde-process-modal">Ok</button><button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button></div></form></div></div></div>').appendTo(a(document.body));var e=a("#mdejs-prompt-dialog");e.on("shown.bs.modal",function(){var b=a(".mde-dialog-input");b.focus();var c=b.val();b.val("").val(c),a(".mde-dialog-form",a(this)).submit(function(){return f(),e.modal("hide"),!1})}),a(".mde-process-modal",e).click(function(){f(),e.modal("hide")}),e.on("hide.bs.modal",function(){e.remove()}),e.modal();var f=function(){b=a(".mde-dialog-input").val().replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(b)||(b="http://"+b),d(b)}},e.prototype.findTags=function(a,b){var c,d=this;a&&(c=n.extendRegExp(a,"","$"),this.before=this.before.replace(c,function(a){return d.startTag=d.startTag+a,""}),c=n.extendRegExp(a,"^",""),this.selection=this.selection.replace(c,function(a){return d.startTag=d.startTag+a,""})),b&&(c=n.extendRegExp(b,"","$"),this.selection=this.selection.replace(c,function(a){return d.endTag=a+d.endTag,""}),c=n.extendRegExp(b,"^",""),this.after=this.after.replace(c,function(a){return d.endTag=a+d.endTag,""}))},e.prototype.trimWhitespace=function(a){var b,c,d=this;a?b=c="":(b=function(a){return d.before+=a,""},c=function(a){return d.after=a+d.after,""}),this.selection=this.selection.replace(/^(\s*)/,b).replace(/(\s*)$/,c)},e.prototype.skipLines=function(a,b,c){void 0===a&&(a=1),void 0===b&&(b=1),a++,b++;var d,e;if(navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+m.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+m.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+m.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+m.$1,this.before){for(d=e="";a--;)d+="\\n?",e+="\n";c&&(d="\\n*"),this.before=this.before.replace(new m(d+"$",""),e)}if(this.after){for(d=e="";b--;)d+="\\n?",e+="\n";c&&(d="\\n*"),this.after=this.after.replace(new m(d,""),e)}};var w=j.prototype;w.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",w.unwrap=function(a){var b=new m("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");a.selection=a.selection.replace(b,"$1 $2")},w.doUndo=function(a,b){l.setCommandMode(),l.undo()},w.wrap=function(a,b){this.unwrap(a);var c=new m("(.{1,"+b+"})( +|$\\n?)","gm"),d=this;a.selection=a.selection.replace(c,function(a,b){return new m("^"+d.prefixes,"").test(a)?a:b+"\n"}),a.selection=a.selection.replace(/\s+$/,"")},w.doBold=function(a,b){return this.doBorI(a,b,2,this.getString("boldexample"))},w.doItalic=function(a,b){return this.doBorI(a,b,1,this.getString("italicexample"))},w.doBorI=function(a,b,c,d){a.trimWhitespace(),a.selection=a.selection.replace(/\n{2,}/g,"\n");var e=/(\**$)/.exec(a.before)[0],f=/(^\**)/.exec(a.after)[0],g=Math.min(e.length,f.length);if(g>=c&&(2!=g||1!=c))a.before=a.before.replace(m("[*]{"+c+"}$",""),""),a.after=a.after.replace(m("^[*]{"+c+"}",""),"");else if(!a.selection&&f){a.after=a.after.replace(/^([*_]*)/,""),a.before=a.before.replace(/(\s?)$/,"");var h=m.$1;a.before=a.before+f+h}else{a.selection||f||(a.selection=d);var i=1>=c?"*":"**";a.before=a.before+i,a.after=i+a.after}},w.stripLinkDefs=function(a,b){return a=a.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(a,c,d,e,f){return b[c]=a.replace(/\s*$/,""),e?(b[c]=a.replace(/["(](.+?)[")]$/,""),e+f):""})},w.addLinkDef=function(a,b){var c=0,d={};a.before=this.stripLinkDefs(a.before,d),a.selection=this.stripLinkDefs(a.selection,d),a.after=this.stripLinkDefs(a.after,d);for(var e="",f=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,g=a.before+a.selection+a.after,h=v.converter.makeHtml(g),i="http://this-is-a-real-link.biz/";-1!=h.indexOf(i);)i+="nicetry/";var j="\n\n",k=0,l=g.replace(f,function r(a,b,c,d,e,g,h){k+=h,j+=" ["+k+"]: "+i+k+"/unicorn\n",k+=b.length,c=c.replace(f,r),k-=b.length;var l=b+c+d+k+g;return k-=h,l});h=v.converter.makeHtml(l+j);var m=function(a){return-1!==h.indexOf(i+a+"/unicorn")},n=function(a){c++,a=a.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+c+"]:"),e+="\n"+a},o=function(a,b,e,g,h,i,j){return m(k+j)?(k+=j+b.length,e=e.replace(f,o),k-=j+b.length,d[h]?(n(d[h]),b+e+g+c+i):a):a},p=a.before.length;a.before=a.before.replace(f,o),k+=p,p=a.selection.length,b?n(b):a.selection=a.selection.replace(f,o),k+=p;var q=c;return a.after=a.after.replace(f,o),a.after&&(a.after=a.after.replace(/\n*$/,"")),a.after||(a.selection=a.selection.replace(/\n*$/,"")),a.after+="\n\n"+e,q},w.doLink=function(a,b){this.doLinkOrImage(a,b,!1)},w.doImage=function(a,b){this.doLinkOrImage(a,b,!0)},w.doLinkOrImage=function(a,b,c){if(a.trimWhitespace(),a.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(a.endTag.length>1&&a.startTag.length>0)){if(a.selection=a.startTag+a.selection+a.endTag,a.startTag=a.endTag="",/\n\n/.test(a.selection))return void this.addLinkDef(a,null);var d=this,e=function(e){if(null!==e){a.selection=(" "+a.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var f=" [999]: "+k(e),g=d.addLinkDef(a,f);a.startTag=c?"![":"[",a.endTag="]["+g+"]",a.selection||(c?a.selection=d.getString("imagedescription"):a.selection=d.getString("linkdescription"))}b()};return c?p.prompt(this.getString("imagedialog"),s,e):p.prompt(this.getString("linkdialog"),t,e),!0}a.startTag=a.startTag.replace(/!?\[/,""),a.endTag="",this.addLinkDef(a,null)},w.doAutoindent=function(a,b){var c=this,d=!1;a.before=a.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),a.before=a.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),a.before=a.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),a.selection||/^[ \t]*(?:\n|$)/.test(a.after)||(a.after=a.after.replace(/^[^\n]*/,function(b){return a.selection=b,""}),d=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(a.before)&&c.doList&&c.doList(a),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(a.before)&&c.doBlockquote&&c.doBlockquote(a),/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&c.doCode&&c.doCode(a),d&&(a.after=a.selection+a.after,a.selection="")},w.doBlockquote=function(a,b){a.selection=a.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(b,c,d,e){return a.before+=c,a.after=e+a.after,d}),a.before=a.before.replace(/(>[ \t]*)$/,function(b,c){return a.selection=c+a.selection,""}),a.selection=a.selection.replace(/^(\s|>)+$/,""),a.selection=a.selection||this.getString("quoteexample");var c,d="",e="";if(a.before){for(var f=a.before.replace(/\n$/,"").split("\n"),g=!1,h=0;h<f.length;h++){var i=!1;c=f[h],g=g&&c.length>0,/^>/.test(c)?(i=!0,!g&&c.length>1&&(g=!0)):i=/^[ \t]*$/.test(c)?!0:g,i?d+=c+"\n":(e+=d+c,d="\n")}/(^|\n)>/.test(d)||(e+=d,d="")}a.startTag=d,a.before=e,a.after&&(a.after=a.after.replace(/^\n?/,"\n")),a.after=a.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(b){return a.endTag=b,""});var j=function(b){var c=b?"> ":"";a.startTag&&(a.startTag=a.startTag.replace(/\n((>|\s)*)\n$/,function(a,b){return"\n"+b.replace(/^[ ]{0,3}>?[ \t]*$/gm,c)+"\n"})),a.endTag&&(a.endTag=a.endTag.replace(/^\n((>|\s)*)\n/,function(a,b){return"\n"+b.replace(/^[ ]{0,3}>?[ \t]*$/gm,c)+"\n"}))};/^(?![ ]{0,3}>)/m.test(a.selection)?(this.wrap(a,q.lineLength-2),a.selection=a.selection.replace(/^/gm,"> "),j(!0),a.skipLines()):(a.selection=a.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(a),j(!1),!/^(\n|^)[ ]{0,3}>/.test(a.selection)&&a.startTag&&(a.startTag=a.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(a.selection)&&a.endTag&&(a.endTag=a.endTag.replace(/^\n{0,2}/,"\n\n"))),/\n/.test(a.selection)||(a.selection=a.selection.replace(/^(> *)/,function(b,c){return a.startTag+=c,""}))},w.doCode=function(a,b){var c=/\S[ ]*$/.test(a.before),d=/^[ ]*\S/.test(a.after);if(!d&&!c||/\n/.test(a.selection)){a.before=a.before.replace(/[ ]{4}$/,function(b){return a.selection=b+a.selection,""});var e=1,f=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&(e=0),/^\n(\t|[ ]{4,})/.test(a.after)&&(f=0),a.skipLines(e,f),a.selection?/^[ ]{0,3}\S/m.test(a.selection)?/\n/.test(a.selection)?a.selection=a.selection.replace(/^/gm,"    "):a.before+="    ":a.selection=a.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(a.startTag="    ",a.selection=this.getString("codeexample"))}else a.trimWhitespace(),a.findTags(/`/,/`/),a.startTag||a.endTag?a.endTag&&!a.startTag?(a.before+=a.endTag,a.endTag=""):a.startTag=a.endTag="":(a.startTag=a.endTag="`",a.selection||(a.selection=this.getString("codeexample")))},w.doUlList=function(a,b){return this.doList(a,b,!1)},w.doOlList=function(a,b){return this.doList(a,b,!0)},w.doList=function(a,b,c){var d=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,e=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,f="-",g=1,h=function(){var a;return c?(a=" "+g+". ",g++):a=" "+f+" ",a},i=function(a){return void 0===c&&(c=/^\s*\d/.test(a)),a=a.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(a){return h()})};if(a.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!a.before||/\n$/.test(a.before)||/^\n/.test(a.startTag)||(a.before+=a.startTag,a.startTag=""),a.startTag){var j=/\d+[.]/.test(a.startTag);if(a.startTag="",a.selection=a.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(a),a.skipLines(),j&&(a.after=a.after.replace(e,i)),c==j)return}var k=1;a.before=a.before.replace(d,function(a){return/^\s*([*+-])/.test(a)&&(f=m.$1),k=/[^\n]\n\n[^\n]/.test(a)?1:0,i(a)}),a.selection||(a.selection=this.getString("litem"));var l=h(),n=1;a.after=a.after.replace(e,function(a){return n=/[^\n]\n\n[^\n]/.test(a)?1:0,i(a)}),a.trimWhitespace(!0),a.skipLines(k,n,!0),a.startTag=l;var o=l.replace(/./g," ");this.wrap(a,q.lineLength-o.length),a.selection=a.selection.replace(/\n/g,"\n"+o)},w.doHeading=function(a,b){if(a.selection=a.selection.replace(/\s+/g," "),a.selection=a.selection.replace(/(^\s+|\s+$)/g,""),!a.selection)return a.startTag="## ",a.selection=this.getString("headingexample"),void(a.endTag=" ##");var c=0;a.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(a.startTag)&&(c=m.lastMatch.length),a.startTag=a.endTag="",a.findTags(null,/\s?(-+|=+)/),/=+/.test(a.endTag)&&(c=1),/-+/.test(a.endTag)&&(c=2),a.startTag=a.endTag="",a.skipLines(1,1);var d=0==c?2:c-1;if(d>0){var e=d>=2?"-":"=",f=a.selection.length;for(f>q.lineLength&&(f=q.lineLength),a.endTag="\n";f--;)a.endTag+=e}},w.doHorizontalRule=function(a,b){a.startTag="----------\n",a.selection="",a.skipLines(2,1,!0)};var x=new d(v.converter,v);return x.run(a(this)),this}}(jQuery);
//# sourceMappingURL=mdejs.min.js.map
